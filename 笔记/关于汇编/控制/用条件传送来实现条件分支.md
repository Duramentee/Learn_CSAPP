# 用条件传送来实现条件分支

## 1.条件传送指令

![](.\条件传送指令.png)

条件传送指令将会根据上一条比较指令或者测试指令的结果来决定是否进行传送.



考虑c中的三目运算符,这里给出一个条件表达式和赋值的通用形式:

```c
v = test-expr ? then-expr : else-expr;
```

可以用条件控制转移的标准方法来编译这个表达式:

```c
if (!tests-expr)
    goto false;

v = then-expr;
goto done;

false:
	v = else-expr;
done:
```

 基于条件传送的代码,会对then-expr和else-expr都求值,最终值的选择基于对test-expr的求值,可以用以下抽象代码描述:

```c
v  = then-expr
ve = else-expr;
t  = test-expr;
if (!t)
	v= ve;
```

这个序列中的最后一条语句使用条件传送实现的,只有当测试条件t满足的时候,vt的值才会被复制到v中.

应当将处理器的工作考虑成一条流水线,由于处理器通常会尝试预测分支,并将一系列的操作连在一起作为流水线处理,如果发生了预测错误,那么处理器此时会放弃掉流水线上的所有值,这会带来相当大程度的性能损失,所以gcc一般都会采用条件跳转的方式而不是条件传送来进行.

一个实例:

![](.\练习题3.21.png)

答案如下:

![](.\练习题3.21答案.png)
