# 入栈和出栈指令

![](.\入栈和出栈指令.png)

```assembly
;第一条 pushq S 指令(压栈或说是入栈指令)可以用两条指令语句代替
pushq %rbp ;这个入栈指令在效果上与下面两条指令一致

subq $8, %rsp ;栈指针先减8
movq %rbp, (%rsp) ;之后将 rbp内 的内容写入到 rsp内所存的内存 处.
```

```assembly
;第二条 popq D 指令(单出或者说是出栈指令)可以用两条指令语句代替
popq %rax ;这个出栈指令在效果上与下面两条指令一致

movq (%rsp), %rax ;先将 rsp内所存内存处 的内容写入到 寄存器rax 中.
addq $8, %rsp ;栈指针之后再加8
```

## 一个入栈和出栈的实例

![](.\一个压栈和出栈的实例.png)

初始状态下 %rax = 0x123, %rsp = 0x108

图1 -> 图2

第一步 %rsp-=8 得到 %rsp = 0x100, 第二步对寄存器rsp内的地址解引用存入0x123, 也就是*0x100=0x123.

图2 -> 图3

第一步 将(%rax)的值传给%rdx 也就是读出%rax中内存对应值并且存入寄存器%rdx, 第二步,将寄存器rsp中的地址+8